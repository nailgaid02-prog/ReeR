# Squid Proxy Configuration
# Optimized for high load API requests (OpenAI, Claude, Gemini, Grok, etc.)
# Universal HTTP/HTTPS proxy - works with ANY API service

# HTTP порт для прокси
http_port 3128

# Разрешить CONNECT для HTTPS (для всех API: OpenAI, Claude, Gemini, etc.)
acl SSL_ports port 443
acl CONNECT method CONNECT
http_access allow CONNECT SSL_ports

# Разрешить обычные HTTP запросы
http_access allow all

# Минимальный cache_dir (ТРЕБУЕТСЯ для ubuntu/squid, но кэширование отключено)
# 100 MB, 16 first-level dirs, 256 second-level dirs
cache_dir ufs /var/spool/squid 100 16 256

# Кэширование ОТКЛЮЧЕНО (для API запросов кэш не нужен, но cache_dir должен быть)
cache deny all

# Логирование
access_log stdio:/dev/stdout combined
cache_log /dev/null

# Таймауты оптимизированы для API
connect_timeout 30 seconds
read_timeout 180 seconds
request_timeout 60 seconds

# DNS кэширование (ускоряет повторные запросы)
positive_dns_ttl 6 hours
negative_dns_ttl 1 minute

# Форвардинг оригинальных заголовков
forwarded_for on

# Аутентификация (опционально, раскомментируйте если нужна)
# auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwords
# auth_param basic realm Proxy Authentication
# acl authenticated proxy_auth REQUIRED
# http_access allow authenticated
# http_access deny all

# Максимальный размер запроса/ответа (для больших API ответов)
request_body_max_size 100 MB
reply_body_max_size 100 MB

# Оптимизация для большого количества соединений
max_filedescriptors 65536
